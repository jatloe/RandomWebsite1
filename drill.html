<!DOCTYPE html>
<html>
<head>
    <link rel="icon" href="jatloesmile-hd.png">
    <title>Drill Drill Drill</title>
    <style>
      .side{
        display: inline;
      }
      body, button, p, input, select {
        font-family: 'Monospace Typewriter', monospace;
        font-size: 48px;
      }
      #mainTimer {
        display: inline-block;
        transform-origin: center;
      }
    </style>
</head>

<body>
    <p id="problem">Press space to start</p>
    <p id="timer">------------------------------------------------------------</p>
    <p id="score">Score: 0</p>
    <input type="text" id="ansbox" disabled>
    <br> <br> <br>
    <p class="side">Problem type:</p>
    <select name="problemType" id="problemType" onchange="changeProblemType()">
        <option value="binary">Binary</option>
        <option value="divisors">Divisors</option>
        <option value="addition">Addition</option>
        <option value="alphabet">Alphabet</option>
        <option value="alphabetrev">Alphabet (Rev)</option>
    </select>
    <br> <br>
    <p class="side">Time:</p>
    <input type="number" value="60" min="1" max="999" id="timelimit">
    <p class="side">frames in</p>
    <input type="number" value="20" min="1" max="999" id="timelimitfps">
    <p class="side">fps</p>
    <br> <br>
    <button onclick="alert('For binary, you can use ASDFG for 1 and HJKL; for 0. Space to give up or restart. Recommended for Alphabet and Alphabet (Rev) is 60 frames in 60 fps.')">Read this</button>
</body>

<script>

let fps = 20;
let maxTimerLen = 60;
let timer = document.getElementById("timer");
let problemElement = document.getElementById("problem");
let scoreElement = document.getElementById("score");
let problemTypeElement = document.getElementById("problemType");
let answerBox = document.getElementById("ansbox");
let answer = "";
let playing = false;
let score = 0;
let problemType = "binary"; // binary, divisors, addition, alphabet
let playedAtAll = false;

function changeProblemType() {
    problemType = problemTypeElement.value;
}

function lose() {
    playing = false;
    problemElement.innerText = `${problemElement.innerText} -> ${answer} but you put ${answerBox.value}.`;
    if (timer.innerText) problemElement.innerText += " (Incorrect)";
    else problemElement.innerText += " (Out of time)";
    timer.innerText = "-".repeat(maxTimerLen);
    answerBox.value = "";
    answerBox.disabled = true;
    score = 0; // Don't update display until restart
}

function answerChanged() {
    if (!playing) return;

    if (problemType === "binary")
        answerBox.value = answerBox.value.replaceAll(/[asdfg]/g, "1").replaceAll(/[hjkl;]/g, "0").replaceAll(/[^0-9asdfghjkl; ]/g, ""); // Space to give up

    let currInput = answerBox.value;

    if (answer == currInput) {
        answerBox.value = "";
        score++;
        newProblem();
    }
    else if (answer.substring(0, currInput.length) != currInput) lose();
    else console.log(currInput);

    return false;
}

answerBox.oninput = answerChanged;
// answerBox.onmousedown = () => {
//     return true;
// }

function decreaseTimer() {
    if (!playing) return;

    answerBox.focus();

    if (timer.innerText) timer.innerText = timer.innerText.substring(1);
    if (!timer.innerText) lose();
}

function randomInteger(min, max) {
    return Math.floor(Math.random()*(max-min+1)) + min;
}

function generateNewProblem() {
    playing = true;
    answerBox.disabled = false;

    let problem = "";

    if (problemType === "binary") {
        let num = randomInteger(32,63);
        problem = num.toString();
        answer = "";

        while (num) {
            answer = (num % 2).toString() + answer;
            num >>= 1;
        }
    } else if (problemType === "divisors") {
        let num = randomInteger(10,99);
        problem = num.toString();
        answer = 0;

        for (let i = 1; i <= num; i++) {
            if (num % i == 0) answer += 1;
        }

        answer = answer.toString();
    } else if (problemType === "addition") {
        let num1 = randomInteger(100,999);
        let num2 = randomInteger(100,999);
        problem = num1.toString() + " + " + num2.toString();

        answer = (num1+num2).toString();
    } else if (problemType === "alphabet") {
        let num1 = randomInteger(1,26);
        problem = "_ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(num1);

        answer = num1.toString();
    } else if (problemType === "alphabetrev") {
        let num1 = randomInteger(1,26);
        problem = num1.toString();

        answer = "_ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(num1).toLowerCase();
    }

    return problem;
}

function initialize() {
    document.getElementById("timelimit").disabled = true;
    document.getElementById("timelimitfps").disabled = true;
    maxTimerLen = parseInt(document.getElementById("timelimit").value);
    fps = parseInt(document.getElementById("timelimitfps").value);
    setInterval(decreaseTimer, 1000/fps);
}

function newProblem() {
    if (!playedAtAll) {
        initialize();
        playedAtAll = true;
    }

    problemElement.innerText = generateNewProblem();
    timer.innerText = "-".repeat(maxTimerLen);
    scoreElement.innerText = "Score: " + score.toString();
}

document.onkeydown = (e) => {
    if (e.keyCode === 32 && playing === false) {
        newProblem();
    }
}

</script>
</html>