<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="jatloesmile-hd.png">
    <title>John's Idle Game</title>
    <style>
      .side{
        display: inline;
      }
    </style>
  </head>
  <body>
    <p class="side">V1.2.0</p>
    <button onclick="save()" class="side">Save points only</button>
    <button onclick="reset()">RESET THE GAME(refresh before clicking this to reset)</button>
    <h3 id="points">You have 1 points.</h3>
    <p class="side" id="boostDisplay">Boost: 1</p>
    <button type="button" onclick="buyBoost()" id="boost">Buy boost: 100 points</button>
    <br>
    <p class="side" id="gen1Display">Generator 1: 1</p>
    <button type="button" onclick="buyGen(1)" id="gen1" class="side">1 -> 1</button>
    <button type="button" onclick="buyAuto(1)" id="auto1">Generator 1 autobuyer: 1e50 points</button>
    <br>
    <p class="side" id="gen2Display">Generator 2: 1</p>
    <button type="button" onclick="buyGen(2)" id="gen2" class="side">1 -> 1</button>
    <button type="button" onclick="buyAuto(2)" id="auto2">Generator 2 autobuyer: 1e100 points</button>
    <br>
    <p class="side" id="gen3Display">Generator 3: 1</p>
    <button type="button" onclick="buyGen(3)" id="gen3" class="side">1 -> 1</button>
    <button type="button" onclick="buyAuto(3)" id="auto3">Generator 3 autobuyer: 1e150 points</button>
    <br>
    <p class="side" id="gen4Display">Generator 4: 1</p>
    <button type="button" onclick="buyGen(4)" id="gen4" class="side">1 -> 1</button>
    <button type="button" onclick="buyAuto(4)" id="auto4">Generator 4 autobuyer: 1e200 points</button>
    <br>
    <p class="side" id="gen5Display">Generator 5: 1</p>
    <button type="button" onclick="buyGen(5)" id="gen5" class="side">1 -> 1</button>
    <button type="button" onclick="buyAuto(5)" id="auto5">Generator 5 autobuyer: 1e250 points</button>
    <br>
    <p class="side" id="gen6Display">Generator 6: 1</p>
    <button type="button" onclick="buyGen(6)" id="gen6" class="side">1 -> 1</button>
    <button type="button" onclick="buyAuto(6)" id="auto6">Generator 6 autobuyer: 1e300 points</button>
  </body>
  <script>
    /*Credits:
    john0512 - Original game idea creator, he created the game on Scratch then gave me permission to put it on my website; Playtester
    02C00000 - Gave numerous suggestions on improving the game
    DottedCalculator: Playtester
    jatloe - Me!
    */
    
    //Basic setup
    let points = 1;
    let gencount = [1,1,1,1,1,1,points];
    let boost = 1;
    let IP = 0;
    let rate = 1;
    let largestindex=0;
    let autobuyer = [false,false,false,false,false,false];
    let autocosts = [Math.pow(10,50),Math.pow(10,100),Math.pow(10,150),Math.pow(10,200),Math.pow(10,250),Math.pow(10,300)];
    load();
    setInterval(update,50);
    
    function update() {
      gencount[6] = points; // Essentially letting generator 0 to reference points in a for loop
      //Check autobuyers
      for(i=0;i<=5;i++) {
        if(autobuyer[i] == true) {
          gencount[i] = Math.sqrt(gencount[workingIndex(i-1)]);
        }
      }
      //Increase points, update displays
      rate = gencount[0]*gencount[1]*gencount[2]*gencount[3]*gencount[4]*gencount[5]*boost*Math.pow(1+IP,3);
      points = points + rate;
      document.getElementById("points").innerHTML = "You have " + stringify(points) + " points.";
      document.getElementById("boost").innerHTML = "Buy boost: " + booststring(boostCost(boost)) + " points";
      document.getElementById("boostDisplay").innerHTML = "Boost: " + String(boost);
      largestindex=0;
      for(i=0;i<6;i++) {
        document.getElementById("gen" + String(i+1) + "Display").innerHTML = "Generator " + String(i+1) + ": " + stringify(gencount[i]);
        document.getElementById("gen" + String(i+1)).innerHTML = stringify(gencount[i]) + " -> " + stringify(Math.sqrt(gencount[workingIndex(i+6)]));
        if(gencount[i] != 1) {
          largestindex=i;
        }
      }
      //Hide and show generators based on if they are used
      for(j=0;j<=largestindex+1;j++) {
        document.getElementById("gen" + String(j+1) + "Display").style.visibility = "visible";
        document.getElementById("gen" + String(j+1)).style.visibility = "visible";
        document.getElementById("auto" + String(j+1)).style.visibility = "visible";
      }
      for(k=largestindex+2;k<6;k++) {
        document.getElementById("gen" + String(k+1) + "Display").style.visibility = "hidden";
        document.getElementById("gen" + String(k+1)).style.visibility = "hidden";
        document.getElementById("auto" + String(k+1)).style.visibility = "hidden";
      }
    }
      
    function save() {
      let info = {"points":points,"gencount":gencount,"boost":boost,"IP":IP,"autobuyer":autobuyer};
      let player = JSON.stringify(info);
      localStorage.setItem('johnidlesave1', player);
    }
    
    function load() {
      if(localStorage.getItem('johnidlesave1') != null) {
        info = JSON.parse(localStorage.getItem('johnidlesave1'));
        points = info.points;
        gencount = info.gencount;
        boost = info.boost;
        IP = info.IP;
        autobuyer = info.autobuyer;
      } else if (localStorage.getItem('johnidlepoints') != null) {
        points = Number(localStorage.getItem('johnidlepoints'));
      }
    }
    
    //Hotkeys
    document.onkeyup = function(e) {
      if (e.which == 49 || e.which == 97) {
        buyGen(1);
      } else if (e.which == 50 || e.which == 98) {
        buyGen(2);
      } else if (e.which == 51 || e.which == 99) {
        buyGen(3);
      } else if (e.which == 52 || e.which == 100) {
        buyGen(4);
      } else if (e.which == 53 || e.which == 101) {
        buyGen(5);
      } else if (e.which == 54 || e.which == 102) {
        buyGen(6);
      } else if (e.which == 66) {
        buyBoost();
      }
    };
    
    window.addEventListener('beforeunload', function(e) {
      save();
    });
    
    //This function turns numbers into nice numbers
    function stringify(number) {
      if(number<1000000) {
        return number.toFixed(3);
      } else if(isFinite(number)) {
        let power = Math.floor(Math.log10(number));
        number = number/Math.pow(10,power);
        return number.toFixed(3) + "e" + String(power);
      } else if(isNaN(number)) {
        return "NaN";
      } else {
        return "Infinity";
      }
    }
    
    function booststring(number) {
      if(number>1000000) {
        return "1e" + String(Math.log10(number));
      } else {
        return number;
      }
    }
    
    //WOWLOG!!
    function log(a,b) {
      return Math.round(Math.log(b) / Math.log(a));
    }
    
    function boostCost(x) {
      return Math.pow(10,Math.pow(2,log(3,x)+1));
    }
    
    function buyBoost() {
      if(points>=boostCost(boost) && isFinite(boostCost(boost))) {
        points = points - boostCost(boost);
        boost = boost * 3;
        update();
      }
    }
    
    //Really annoying with the workingIndex lol, I'm glad it worked
    function buyGen(num) {
      if(gencount[workingIndex(num+6)] < Math.sqrt(gencount[workingIndex(num+5)])) {
        gencount[workingIndex(num+6)] = Math.sqrt(gencount[workingIndex(num+5)]);
        for(let i=-1;i<num-1;i++) {
          gencount[workingIndex(i)]=1;
        }
        points = 1;
        update();
      }
    }
    
    function workingIndex(num) {
      return (num+700)%7; //Essentially forces the input to be positive without changing residue mod 7
    }
    
    function buyAuto(num) {
      if(points>=autocosts[num-1]) {
        points = points - autocosts[num-1];
        autobuyer[num-1]=true;
        document.getElementById("auto" + String(num)).innerHTML = "Generator " + String(num) + " autobuyer bought!";
        update();
      }
    }
    
    function reset() {
      points=1;
      localStorage.setItem('johnidlepoints', 1);
      document.location.reload();
    }
  </script>
</html>
